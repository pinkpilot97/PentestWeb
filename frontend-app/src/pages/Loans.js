import React, { useEffect } from 'react';
import { useForm } from 'react-hook-form';
import {useCutomer} from "../context/CustomerContext"
import {MdOutlineKeyboardArrowRight} from "react-icons/md";
import {useNavigate, useParams} from 'react-router-dom'

const Loans = () => {
  const {sendRequest, getCustomerReq, updateCustomerReq} = useCutomer()
  const navigate = useNavigate()
  const {register, handleSubmit,  formState: { errors }, setValue} = useForm();
  const params = useParams()


  useEffect(() => {
    async function getCustomerData(){
      if(params.id){
        const customer = await getCustomerReq(params.id)
        setValue('fname',customer.fname)
        setValue('lname',customer.lname)
        setValue('email',customer.email)
        setValue('address',customer.address)
        setValue('profession',customer.profession)
        setValue('revenue',customer.revenue)
      }
    }
    getCustomerData()
  }, [])


  const onSubmit = handleSubmit(async (data) => {
    if(params.id){
      console.log(data)
      updateCustomerReq(params.id, data)
    } else {
      sendRequest(data)
      console.log(data)
    }
    navigate('/loans/customers')
  })
  return (
    <div className="flex w-full justify-center px-3 py-20 h-screen " >
    <div className='bg-zinc-600 max-w-md w-full p-10 rounded-md'>
      <h1 className='text-4xl font-bold text-white'>Loan request</h1>
      <form className="mt-10" onSubmit={onSubmit}>
        <input
        className='w-full bg-zinc-500 text-white px-4 py-2 rounded-md my-2'
        type="text"
        {...register("fname", { required: true })}
        placeholder='First Name'
        />
        <input
        className='w-full bg-zinc-500 text-white px-4 py-2 rounded-md my-2'
        type="text" 
        {...register("lname", { required: true })}
        placeholder='Last Name'
        />
        <input
        className='w-full bg-zinc-500 text-white px-4 py-2 rounded-md my-2'
        type="email" 
        {...register("email", { required: true })}
        placeholder='Email'
        />
        {errors.email && <p className='text-red-500'>email is required</p>}

        <input
        className='w-full bg-zinc-500 text-white px-4 py-2 rounded-md my-2'
        type="text" 
        {...register("address", { required: true })}
        placeholder='Address'
        />
        <input
        className='w-full bg-zinc-500 text-white px-4 py-2 rounded-md my-2'
        type="text"
        {...register("profession", { required: true })}
        placeholder='profession'
        />
        <input
        className='w-full bg-zinc-500 text-white px-4 py-2 rounded-md my-2'
        type="text"
        {...register("revenue", { required: true })}
        placeholder='revenue'
        />
        <button className='text-white w-fit px-6 py-3
              my-2 flex items-center rounded-md bg-gradient-to-r from-sky-600 via-sky-400 to-sky-300 cursor-pointer'>
                Send
                <span className='group-hover:rotate-90 duration-300'>
                  <MdOutlineKeyboardArrowRight size={25} className="ml-1 "/>
                </span>
        </button>
      </form>
    </div>
  </div>
  );
};

export default Loans;